expression brands_RAW =
		let
		    Source = Csv.Document(File.Contents("E:\Projects\OtherProjects\Eniac_Discount analysis\Data\brands.csv"),[Delimiter=",", Columns=2, Encoding=1252, QuoteStyle=QuoteStyle.None]),
		    #"Changed Type" = Table.TransformColumnTypes(Source,{{"Column1", type text}, {"Column2", type text}}),
		    #"Removed Duplicates" = Table.Distinct(#"Changed Type", {"Column1"}),
		    #"Promoted Headers" = Table.PromoteHeaders(#"Removed Duplicates", [PromoteAllScalars=true]),
		    #"Changed Type1" = Table.TransformColumnTypes(#"Promoted Headers",{{"short", type text}, {"long", type text}})
		in
		    #"Changed Type1"
	lineageTag: 6cbeb00c-5162-4efd-be32-520ce205c7a2
	queryGroup: 0-Raw

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

expression orderlines_RAW =
		let
		    Source = Csv.Document(File.Contents("E:\Projects\OtherProjects\Eniac_Discount analysis\Data\orderlines.csv"),[Delimiter=",", Columns=7, Encoding=1252, QuoteStyle=QuoteStyle.None]),
		    #"Promoted Headers" = Table.PromoteHeaders(Source, [PromoteAllScalars=true])
		in
		    #"Promoted Headers"
	lineageTag: 0970f5e2-e9dc-4bff-8e6f-7ce16302e9f1
	queryGroup: 0-Raw

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

expression orders_RAW =
		let
		    Source = Csv.Document(File.Contents("E:\Projects\OtherProjects\Eniac_Discount analysis\Data\orders.csv"),[Delimiter=",", Columns=4, Encoding=1252, QuoteStyle=QuoteStyle.None]),
		    #"Promoted Headers" = Table.PromoteHeaders(Source, [PromoteAllScalars=true])
		in
		    #"Promoted Headers"
	lineageTag: ca0ebd80-6fe5-480b-8959-bfab1b1d06ee
	queryGroup: 0-Raw

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

expression products_RAW =
		let
		    Source = Csv.Document(File.Contents("E:\Projects\OtherProjects\Eniac_Discount analysis\Data\products.csv"),[Delimiter=",", Columns=7, Encoding=65001, QuoteStyle=QuoteStyle.None]),
		    #"Promoted Headers" = Table.PromoteHeaders(Source, [PromoteAllScalars=true])
		in
		    #"Promoted Headers"
	lineageTag: ff55418b-be1d-40b5-8d15-a262ae4a9169
	queryGroup: 0-Raw

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

expression orderlines_CLEAN =
		let
		    Source = orderlines_RAW,
		    #"Removed Columns (product_id)" = Table.RemoveColumns(Source,{"product_id"}),
		    #"Removed Duplicates" = Table.Distinct(#"Removed Columns (product_id)", {"id"}),
		    #"Removed Blank Rows" = Table.SelectRows(#"Removed Duplicates", each not List.IsEmpty(List.RemoveMatchingItems(Record.FieldValues(_), {"", null}))),
		    #"Changed Type" = Table.TransformColumnTypes(#"Removed Blank Rows",{{"unit_price", type number}}),
		    #"Removed Errors" = Table.RemoveRowsWithErrors(#"Changed Type", {"unit_price"}),
		    #"Changed Type1" = Table.TransformColumnTypes(#"Removed Errors",{{"product_quantity", Int64.Type}, {"date", type datetime}})
		in
		    #"Changed Type1"
	lineageTag: d2b48719-703d-4da0-8632-a5c6f1d7660a
	queryGroup: Cleaning

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

expression products_CLEAN =
		let
		    Source = products_RAW,
		    #"Filtered Rows" = Table.SelectRows(Source, each ([price] <> "")),
		    #"Removed Duplicates" = Table.Distinct(#"Filtered Rows", {"sku"}),
		    #"Changed Type" = Table.TransformColumnTypes(#"Removed Duplicates",{{"price", type number}}),
		    #"Removed Errors" = Table.RemoveRowsWithErrors(#"Changed Type", {"price"}),
		    #"Removed Columns" = Table.RemoveColumns(#"Removed Errors",{"promo_price"}),
		    #"Changed Type1" = Table.TransformColumnTypes(#"Removed Columns",{{"in_stock", Int64.Type}}),
		    #"Merged Queries" = Table.NestedJoin(#"Changed Type1", {"sku"}, orderlines_CLEAN, {"sku"}, "orderlines_CLEAN", JoinKind.Inner),
		    #"Removed Columns1" = Table.RemoveColumns(#"Merged Queries",{"orderlines_CLEAN"})
		in
		    #"Removed Columns1"
	lineageTag: abc94889-9dc1-4d59-94e4-59c328a812f6
	queryGroup: Cleaning

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

expression products_with_categoies =
		let
		    Source = products_CLEAN,
		    #"Run Python script" = Python.Execute("# to add ""categories"" column#(lf)df[""category""] = """"#(lf)#(lf)#empty category and type masks#(lf)category = df.category == ''#(lf)type_mask = df.type == 'Empty'#(lf)#(lf)# brand masks#(lf)PAC_mask = df.sku.str.contains('pac', case=False, na=False)#(lf)SEA_mask = (df.sku.str.contains('SEA', case=False, na=False) | #(lf)            df.sku.str.contains('CRU', case=False, na=False) | #(lf)            df.sku.str.contains('KIN', case=False, na=False) | #(lf)            df.sku.str.contains('WDT', case=False, na=False)) #(lf)WD_mask = df.sku.str.contains('wd', case=False, na=False)#(lf)OWC_mask = df.sku.str.contains('OWC', case=False, na=False)#(lf)NTE_mask = df.sku.str.contains('nte', case=False, na=False)#(lf)#(lf)APP_mask = (df.sku.str.contains('APP', case=False, na=False)  | #(lf)            df.sku.str.contains('AP2', case=False, na=False))#(lf)#(lf)IFX_mask = df.sku.str.contains('ifx', case=False, na=False)#(lf)REP_mask = df.sku.str.contains('REP', case=False, na=False)#(lf)sev_mask = df.sku.str.contains('SEV', case=False, na=False)#(lf)#(lf)# type masks#(lf)#(lf)type_5397_mask = df.type.str.contains(('5397'), case=False, na=False) #! 'NAS, HDD, SSD, Memory stick and cards'#(lf)type_5403_mask = df.type.str.contains(('5403'), case=False, na=False) #! 'Protection, Cases, Backpacks'#(lf)type_5404_mask = df.type.str.contains(('5404'), case=False, na=False) #! 'Electronic Devises'#(lf)type_5384_mask = df.type.str.contains(('5384'), case=False, na=False) #! 'Sound, Headphones, Players'#(lf)type_IMACII_mask = df.type.str.contains(('1282'), case=False, na=False) #! 'Apple iMac'#(lf)type_IMACI_mask = df.type.str.contains(('118692158'), case=False, na=False) #! 'Apple iMac'#(lf)type_IMACIII_mask = df.type.str.contains(('21632158'), case=False, na=False) #! 'Apple iMac'#(lf)type_1364_mask = df.type.str.contains(('1364'), case=False, na=False) #! 'NAS, HDD, SSD, Memory stick and cards'#(lf)type_5395_mask = df.type.str.contains(('5395'), case=False, na=False) #! 'Connectivity & Adapters'#(lf)type_1334_mask = df.type.str.contains(('1334'), case=False, na=False) #! 'Routers'#(lf)type_2449_mask = df.type.str.contains(('2449'), case=False, na=False) #! ""Apple Watch Accessories""#(lf)type_2158_mask = df.type.str.contains(('2158'), case=False, na=False) #! ""Apple MacBook""#(lf)type_1515_mask = df.type.str.contains(('1515'), case=False, na=False) #! ""Power Banks, Batteries""#(lf)type_5398_mask = df.type.str.contains(('5398'), case=False, na=False) #! 'Sound, Headphones, Players'#(lf)type_5399_mask = df.type.str.contains(('5399'), case=False, na=False) #! 'Charging Dock, Chargers, Stands, Supports'#(lf)type_5185_mask = df.type.str.contains(('5185'), case=False, na=False) #! ""Apple Watch""#(lf)type_5406_mask = df.type.str.contains(('5406'), case=False, na=False) #! ""Repair service, Install kit, Extended warranty""#(lf)type_1230_mask = df.type.str.contains(('1230'), case=False, na=False) #! ""Cables""#(lf)type_1714_mask = df.type.str.contains(('1714'), case=False, na=False) #! 'Apple iPad'#(lf)type_1433_mask = df.type.str.contains(('1433'), case=False, na=False) #! 'NAS, HDD, SSD, Memory stick and cards'#(lf)type_1715_mask = df.type.str.contains((""1715""), case=False, na=False) #! 'Apple iPod'#(lf)type_1716_mask = df.type.str.contains((""1716""), case=False, na=False) #! ""Apple iPhone""#(lf)type_5407_mask = df.type.str.contains((""5407""), case=False, na=False) #! ""Repair service, Install kit, Extended warranty""#(lf)type_1325_mask = df.type.str.contains((""1325""), case=False, na=False) #! 'Connectivity & Adapters'#(lf)type_8696_mask = df.type.str.contains((""8696""), case=False, na=False) #! 'Connectivity & Adapters'#(lf)type_1229_mask = df.type.str.contains((""1229""), case=False, na=False) #! ""Input devices, styluses""#(lf)type_1387_mask = df.type.str.contains((""1387""), case=False, na=False) #! ""Input devices, styluses""#(lf)type_5401_mask = df.type.str.contains((""5401""), case=False, na=False) #! ""Input devices, styluses""#(lf)type_1231_mask = df.type.str.contains((""1231""), case=False, na=False) #! ""Apple care""#(lf)type_1216_mask = df.type.str.contains((""1216""), case=False, na=False) #! ""Charging Dock, Chargers, Stands, Supports""#(lf)type_5405_mask = df.type.str.contains((""5405""), case=False, na=False) #! ""Apple Watch Accessories""#(lf)type_9094_mask = df.type.str.contains((""9094""), case=False, na=False) #! ""Cameras, Security system""#(lf)type_monitor_mask = df.type.str.contains(('1296'), case=False, na=False) #! 'Monitors'#(lf)type_10142_mask = df.type.str.contains((""10142""), case=False, na=False) #! ""Batteries""#(lf)#(lf)df.loc[category &  (type_5397_mask|type_1364_mask|type_1433_mask|#(lf)                    SEA_mask|WD_mask), 'category'] = 'NAS, HDD, SSD, Memory stick and cards'#(lf)df.loc[category &  type_5403_mask, 'category'] = 'Protection, Cases, Backpacks'#(lf)df.loc[category &  type_5404_mask, 'category'] = 'Electronic Devises'#(lf)df.loc[category &  (type_5384_mask|type_5398_mask), 'category'] = 'Sound, Headphones, Players'#(lf)df.loc[category &  (type_IMACII_mask|type_IMACI_mask|type_IMACIII_mask|PAC_mask), 'category'] = 'Apple iMac'#(lf)df.loc[category &  (type_1334_mask), 'category'] = 'Routers'#(lf)df.loc[category &  (type_5395_mask|type_1325_mask|type_8696_mask), 'category'] = 'Connectivity & Adapters'#(lf)df.loc[category &  (type_2449_mask|type_5405_mask), 'category'] = ""Apple Watch Accessories""#(lf)df.loc[category &  (type_2158_mask), 'category'] = ""Apple MacBook""#(lf)df.loc[category &  (type_1515_mask), 'category'] = ""Power Banks, Batteries""#(lf)df.loc[category &  (type_5399_mask|type_1216_mask), 'category'] = ""Charging Dock, Chargers, Stands, Supports""#(lf)df.loc[category &  (type_5185_mask), 'category'] = ""Apple Watch""#(lf)df.loc[category &  (type_5406_mask|type_5407_mask), 'category'] = ""Repair service, Install kit, Extended warranty""#(lf)df.loc[category &  (type_1230_mask), 'category'] = ""Cables""#(lf)df.loc[category &  (type_1714_mask), 'category'] = ""Apple iPad""#(lf)df.loc[category &  (type_1715_mask), 'category'] = ""Apple iPod""#(lf)df.loc[category &  (type_1716_mask), 'category'] = ""Apple iPhone""#(lf)df.loc[category &  (type_1231_mask), 'category'] = ""Apple care""#(lf)df.loc[category &  (type_monitor_mask), 'category'] = ""Monitors""#(lf)df.loc[category &  (type_9094_mask), 'category'] = ""Cameras, Security system""#(lf)df.loc[category &  (type_10142_mask), 'category'] = ""Batteries""#(lf)#(lf)# name and description mask#(lf)#(lf)type_IFIX_mask = df.name.str.contains('ifix', case=False, na=False)#(lf)#(lf)type_imac_mask = (df.name.str.contains('Apple iMac', case=False, na=False) |#(lf)                df.desc.str.contains('Apple iMac', case=False, na=False) |#(lf)                df.name.str.contains('Apple iMac', case=False, na=False) |#(lf)                df.desc.str.contains('Apple iMac', case=False, na=False))#(lf)#(lf)protector_mask = (df.name.str.contains('Protector', case=False, na=False) | #(lf)                    df.name.str.contains('Backpack', case=False, na=False) |#(lf)                    df.name.str.contains('Bandolier', case=False, na=False) |#(lf)                    df.name.str.contains('Protection', case=False, na=False) |#(lf)                    df.name.str.contains('cover', case=False, na=False)|#(lf)                    df.name.str.contains('case', case=False, na=False)|#(lf)                    df.desc.str.contains('Protector', case=False, na=False) | #(lf)                    df.desc.str.contains('Backpack', case=False, na=False) |#(lf)                    df.desc.str.contains('Bandolier', case=False, na=False) |#(lf)                    df.desc.str.contains('Protection', case=False, na=False) |#(lf)                    df.desc.str.contains('cover', case=False, na=False)|#(lf)                    df.desc.str.contains('case', case=False, na=False) | #(lf)                    df.name.str.contains('housing', case=False, na=False)|#(lf)                    df.desc.str.contains('housing', case=False, na=False) | #(lf)                    df.name.str.contains('Tassel', case=False, na=False)|#(lf)                    df.desc.str.contains('Tassel', case=False, na=False))#(lf)#(lf)monitor_mask = (df.name.str.contains('Monitor', case=False, na=False) |#(lf)                df.desc.str.contains('Monitor', case=False, na=False))#(lf)df.loc[category &  monitor_mask, 'category'] = ""Monitors""#(lf)camera_mask = (df.name.str.contains('camera', case=False, na=False)|#(lf)               df.name.str.contains('secur', case=False, na=False)|#(lf)                df.desc.str.contains('night', case=False, na=False)|#(lf)                df.desc.str.contains('extend', case=False, na=False)#(lf)                )#(lf)#(lf)strap_mask = (df.desc.str.contains('strap | armband', case=False, na=False)|#(lf)                df.name.str.contains('strap | armband', case=False, na=False)|#(lf)                df.desc.str.contains('bands', case=False, na=False)|#(lf)                df.name.str.contains('bands', case=False, na=False)|#(lf)                df.desc.str.contains('bracelet', case=False, na=False)|#(lf)                df.name.str.contains('bracelet', case=False, na=False))#(lf)#(lf)#(lf)appl_watch_mask = (df.desc.str.contains('Apple Watch', case=False, na=False)|#(lf)                df.name.str.contains('Apple Watch', case=False, na=False))#(lf)#(lf)df.loc[category & (type_5405_mask | strap_mask) & appl_watch_mask, 'category'] = ""Apple Watch Accessories""#(lf)#(lf)port_mask  = (df.desc.str.contains('display port', case=False, na=False)|#(lf)                df.name.str.contains('display port', case=False, na=False))#(lf)#(lf)cable_mask = (df.desc.str.contains('cable', case=False, na=False)|#(lf)                df.name.str.contains('cable', case=False, na=False)#(lf)                )#(lf)#(lf)headphoenes = (df.desc.str.contains('headphones', case=False, na=False) |#(lf)                df.name.str.contains('headphones', case=False, na=False))#(lf)#(lf)microph_mask = (df.name.str.contains(""microphone | speaker | handsfree | player"", case=False, na=False) | #(lf)                df.desc.str.contains(""microphone | speaker | handsfree | player"", case=False, na=False) )#(lf)#(lf)appmac_mask = (df.name.str.contains('Apple iMac', case=False, na=False) |#(lf)                df.desc.str.contains('PC'))#(lf)#(lf)nas_HD_mask =  (df.name.str.contains(""Hard Drive | drive | nas | "" \#(lf)                        ""Ethernet | raid | SSD | nas server | Hard Thunderbolt"" \#(lf)                        ""| hard disk | external disk | Disk 4TB"", case=False, na=False) |#(lf)                    df.desc.str.contains(""Hard Drive | drive | nas | "" \#(lf)                        ""Ethernet | raid | SSD | nas server | Hard Thunderbolt"" \#(lf)                        ""| hard disk | external disk | Disk 4TB"", case=False, na=False))#(lf)#(lf)df.loc[category & (headphoenes | microph_mask), 'category'] = ""Sound, Headphones, Players""#(lf)#(lf)not_include_mask = (df.name.str.contains(""Satechi Sonic Dual Conical Mac "", case=False, na=False)|#(lf)                    df.desc.str.contains(""tablet | card | protect |microphone | display | pointer "", case=False, na=False)|#(lf)                   #(lf)                    df.name.str.contains(""hub | adapter"", case=False, na=False) |#(lf)                    df.desc.str.contains(""hub | adapter"", case=False, na=False) |#(lf)                    df.name.str.contains(""license |software |  Adobe InDesign"", case=False, na=False) |#(lf)                    df.desc.str.contains(""license |software |  Adobe InDesign"", case=False, na=False) #(lf)                    )#(lf)#(lf)# CASES & Protection Mask 363#(lf)#(lf)type_other_cases_mask = (df.name.str.contains('case | housing | bag | backpack | case cover '#(lf)                            '| Leather Case | cover | Case Macbook | compact case | Travel Case | ' \#(lf)                            'case with cover | Aluminum case | case | Protective Case | Case adaptable |' \#(lf)                            ' case | protec | Protector | Keyboard Protector | Cover for | Protective housing |' \#(lf)                            'Polycarbonate shell | Protective stand | screen protectors | Safety housing |' \#(lf)                            'Screen Saver | Leather Tassel | Defend | folio | bag | bags |backpack  for', case=False, na=False) |#(lf)                        df.desc.str.contains(('case | housing | bag | backpack | case cover'#(lf)                            ' | Leather Case | cover | Case Macbook | compact case | Travel Case |'#(lf)                            ' case with cover | Aluminum case | case | Protective Case | Case adaptable | '#(lf)                            'case | protec | Protector | Keyboard Protector | Cover for | Protective housing |' \#(lf)                            'Polycarbonate shell | Protective stand | screen protectors | Safety housing |' \#(lf)                            'Screen Saver | Leather Tassel | Defend | folio | bag | bags |backpack  for'), case=False, na=False)) #(lf)#(lf)type_OWC_cases_mask = df.sku.str.contains(""owc"", case=False, na=False) # memory, doc#(lf)type_BTC_cases_mask = df.sku.str.contains(""BTC"", case=False, na=False) #(lf)type_THU_cases_mask = df.sku.str.contains(""thu"", case=False, na=False) #(lf)type_hic_cases_mask = df.sku.str.contains(""hic"", case=False, na=False) #(lf)type_mos_cases_mask = df.sku.str.contains(""mos"", case=False, na=False) #(lf)type_mdt_cases_mask = df.sku.str.contains(""mdt"", case=False, na=False) #(lf)type_lif_cases_mask = df.sku.str.contains(""lif"", case=False, na=False) # armband support Belt Clip  accessory adapter#(lf)#(lf)df.loc[(type_other_cases_mask) & category, 'category'] = 'Protection, Cases, Backpacks'#(lf)df.loc[(type_BTC_cases_mask) & category, 'category'] = 'Protection, Cases, Backpacks'#(lf)#(lf)# Repair service, Install kit, Extended warranty #154#(lf)#(lf)repair_mask = (df.name.str.contains('repair | service | calibrator', case=False, na=False) |#(lf)                df.desc.str.contains('repair | service | calibrator', case=False, na=False)|#(lf)                df.desc.str.contains('including parts', case=False, na=False)#(lf)                )##(lf)#(lf)df.loc[(IFX_mask | REP_mask | sev_mask | repair_mask), 'category'] = ""Repair service, Install kit, Extended warranty""#(lf)#(lf)# NAS, HDD, SSD, Memory stick and cards 176 row#(lf)#(lf)memo_mask = (df.name.str.contains('memory | pen drive | pendrive | ssd | nas | hard drive | flash drive |' \#(lf)            'shdc | memory | hdd | raid | SSD | HDD | WD | Seagate | outer case | DAS RAID | expansion module for | ' \#(lf)            'External Disk | external hard drive | NAS server | storage | server | hardware raid | drive |TB portable', case=False, na=False) |#(lf)              df.desc.str.contains('memory | pen drive | pendrive | ssd | nas | hard drive | flash drive | ' \#(lf)              'shdc | memory | hdd | raid | SSD | HDD | WD | Seagate | outer case | DAS RAID | expansion module for | ' \#(lf)              'External Disk | external hard drive | NAS server | storage | server | hardware raid | drive |TB portable', case=False, na=False))#(lf)memo_mask_ = df.sku.str.contains('SEA | CRU | KIN | WDT', case=False, na=False)#(lf)#(lf)warranty_mask = (df.desc.str.contains('warranty | plan | care | extended warranty', case=False, na=False) |  # Did not use 15 rows  with 1231_mask!!#(lf)                 df.name.str.contains('warranty | plan | care | extended warranty', case=False, na=False) #(lf)                 )#(lf)#(lf)df.loc[category & (memo_mask | memo_mask_)& ~ APP_mask & ~warranty_mask, 'category'] = ""NAS, HDD, SSD, Memory stick and cards""#(lf)#(lf)# Apple MacBook 242 rows#(lf)#(lf)type_macbook_mask = (df.name.str.contains('Apple Macbook', case=False, na=False)#(lf)                     | df.desc.str.contains('Apple Macbook', case=False, na=False) |#(lf)                     df.name.str.contains('Macbook', case=False, na=False)#(lf)                     | df.desc.str.contains('Macbook', case=False, na=False) |#(lf)                     df.name.str.contains('laptop', case=False, na=False)#(lf)                     | df.desc.str.contains('laptop', case=False, na=False))#(lf)#(lf)charger_mask = (df.name.str.contains('MagSafe', case=False, na=False)|#(lf)                df.desc.str.contains('MagSafe', case=False, na=False)|#(lf)                df.desc.str.contains('charg', case=False, na=False) |#(lf)                df.name.str.contains('charg', case=False, na=False) |#(lf)                df.desc.str.contains('holder', case=False, na=False) |#(lf)                df.name.str.contains('support | Mount', case=False, na=False) |#(lf)                df.desc.str.contains('support | Mount', case=False, na=False)#(lf)                )#(lf)battery_mask = (df.desc.str.contains('battery | mAh | power bank', case=False, na=False)|#(lf)                df.name.str.contains('battery | mAh | power bank', case=False, na=False)|#(lf)                df.desc.str.contains('W ')| df.name.str.contains('W '))#(lf)#(lf)df.loc[category & type_macbook_mask & APP_mask & ~(charger_mask | battery_mask), 'category'] = ""Apple MacBook""#(lf)#(lf)# Apple iMac 133#(lf)#(lf)type_imac_mask = (df.name.str.contains('Apple iMac | desktop | PC | desktop computer ', case=False, na=False) |#(lf)                df.desc.str.contains('Apple iMac | desktop | PC | desktop computer ', case=False, na=False))#(lf)#(lf)software_mask = (df.desc.str.contains('Software license', case=False, na=False) |#(lf)                  df.name.str.contains('Software license', case=False, na=False) |#(lf)                  df.desc.str.contains('software | microsoft', case=False, na=False) |#(lf)                  df.name.str.contains('software | microsoft', case=False, na=False) |#(lf)                  df.desc.str.contains('licenses', case=False, na=False) |#(lf)                  df.name.str.contains('licenses', case=False, na=False) |#(lf)                  df.desc.str.contains('Window') |#(lf)                  df.name.str.contains('Window'))#(lf)#(lf)type_connector_mask = (df.name.str.contains(('adapter | connector | adap'), case=False, na=False)|#(lf)                       df.desc.str.contains(('adapter | connector | adap'), case=False, na=False))#(lf)#(lf)#(lf)df.loc[category & type_imac_mask & ~(software_mask | type_connector_mask | camera_mask), 'category'] = ""Apple iMac""#(lf)#(lf)#Apple iPhone 42#(lf)#(lf)type_iphone_mask = (df.name.str.contains('Apple iPhone', case=False, na=False) |#(lf)                    df.desc.str.contains('Apple iPhone', case=False, na=False))#(lf)#(lf)df.loc[category & type_iphone_mask, 'category'] = ""Apple iPhone""#(lf)#(lf)# Apple iPad 12 row#(lf)#(lf)type_ipad_mask = (df.name.str.contains('Apple iPad', case=False, na=False) |#(lf)                  df.desc.str.contains('Apple iPad', case=False, na=False)#(lf)                  )#(lf)#(lf)df.loc[category & type_ipad_mask & ~protector_mask, 'category'] = ""Apple iPad""#(lf)#(lf)# Connectivity & Adapters 54 rows#(lf)#(lf)type_connector_mask = (df.name.str.contains(('adapter | connector | adap'), case=False, na=False)|#(lf)                       df.desc.str.contains(('adapter | connector | adap'), case=False, na=False))#(lf) #(lf)df.loc[category & type_connector_mask & ~(protector_mask | charger_mask), 'category'] = ""Connectivity & Adapters""#(lf)#(lf)# Input devices, styluses 45#(lf)type_pens_mask = (df.name.str.contains(('mouse | trackpad | keyapd | keyboard | stylus | pointer | pen'), case=False, na=False)|#(lf)                    df.desc.str.contains(('mouse | trackpad | keyapd | keyboard stylus | pointer | pen'), case=False, na=False))#(lf)#(lf)tablet_mask = (df.name.str.contains('tablet', case=False, na=False) | #(lf)               df.desc.str.contains('tablet', case=False, na=False))#(lf)#(lf)df.loc[category & type_pens_mask &~tablet_mask & ~charger_mask, 'category'] = ""Input devices, styluses""#(lf)#(lf)# Tablets 75 rows#(lf)#(lf)tablet_mask = (df.name.str.contains('tablet', case=False, na=False) | #(lf)               df.desc.str.contains('tablet', case=False, na=False))#(lf)#(lf)charger_mask = (df.name.str.contains('MagSafe', case=False, na=False)|#(lf)                df.desc.str.contains('MagSafe', case=False, na=False)|#(lf)                df.desc.str.contains('charg', case=False, na=False) |#(lf)                df.name.str.contains('charg', case=False, na=False) |#(lf)                df.desc.str.contains('holder', case=False, na=False) |#(lf)                df.name.str.contains('support | Mount', case=False, na=False) |#(lf)                df.desc.str.contains('support | Mount', case=False, na=False)#(lf)                )#(lf)#(lf)discount_mask = df.desc.str.contains(""discount"", case=False, na=False)#(lf)#(lf)df.loc[category & tablet_mask & ~ discount_mask, 'category'] = ""Tablets""#(lf)#(lf)# Monitors 53 row#(lf)monitor_mask = (df.name.str.contains('Monitor | 4K HDR | Display | HDMI | FHD | LED | HDR' \#(lf)                'LCD Monitor | Ultra High Definition | Samsung Monitor | Full HD | 4K monitor', case=False, na=False) |#(lf)                df.desc.str.contains('Monitor | 4K HDR | Display | HDMI | FHD | LED | HDR' \#(lf)                'LCD Monitor | Ultra High Definition | Samsung Monitor | Full HD | 4K monitor', case=False, na=False))#(lf)#(lf)watch_mask = (df.name.str.contains('smartwatch', case=False, na=False) |#(lf)                df.desc.str.contains('smartwatch', case=False, na=False))#(lf)dockst_mask = (df.name.str.contains('Docking station | Dock USB-C multiple | Dock with | dock | docking | USB Hub | hub thunder', case=False, na=False)|#(lf)                df.desc.str.contains('Docking station | Dock USB-C multiple | Dock with | dock | docking | USB Hub | hub thunder', case=False, na=False) #(lf)                )#USB Hub#(lf)#(lf)df.loc[category & monitor_mask & ~(camera_mask | cable_mask | battery_mask | watch_mask #(lf)                                            | strap_mask | port_mask | dockst_mask | type_connector_mask ), 'category'] = ""Monitors""#(lf)#(lf)# ""Cameras, Security system"" 46#(lf)camera_mask = (df.name.str.contains('camera | Security Cameras | smart security cameras' \#(lf)                '| Safety System | cameras | secur | night | extend', case=False, na=False)|#(lf)               df.desc.str.contains('camera | Security Cameras | smart security cameras' \#(lf)                '| Safety System | cameras | secur | night | extend', case=False, na=False)#(lf)                )#(lf)#(lf)warranty_mask = (df.desc.str.contains('warranty | plan | care | extended warranty', case=False, na=False) |  # Did not use 15 rows  with 1231_mask!!#(lf)                 df.name.str.contains('warranty | plan | care | extended warranty  | Security Cameras | smart security cameras ' \#(lf)                 ' | Safety System | cameras', case=False, na=False) #(lf)                 )#(lf)#(lf)df.loc[category & (type_9094_mask & camera_mask) , 'category'] = ""Cameras, Security system""#(lf)#(lf)#Charging Dock, Chargers, Stands, Supports 128#(lf)#(lf)charger_mask = (df.name.str.contains('MagSafe | charg | holder | support | mount', case=False, na=False)|#(lf)                df.desc.str.contains('MagSafe | charg | holder | support | mount', case=False, na=False)#(lf)                )#(lf)#(lf)dockst_mask = (df.name.str.contains('Docking station | Dock USB-C multiple | Dock with | dock | docking | USB Hub | hub thunder', case=False, na=False)|#(lf)                df.desc.str.contains('Docking station | Dock USB-C multiple | Dock with | dock | docking | USB Hub | hub thunder', case=False, na=False) #(lf)                )#USB Hub#(lf)#(lf)df.loc[category &  (type_1216_mask | charger_mask | dockst_mask) & ~(protector_mask), 'category'] = ""Charging Dock, Chargers, Stands, Supports""#(lf)#(lf)# Batteries 45#(lf)#(lf)battery_mask = (df.desc.str.contains('battery | mAh | power bank', case=False, na=False)|#(lf)                df.name.str.contains('battery | mAh | power bank', case=False, na=False)|#(lf)                df.desc.str.contains('W ')| df.name.str.contains('W '))#(lf)#(lf)df.loc[category & (battery_mask | type_10142_mask), 'category'] = ""Batteries""#(lf)#(lf)# Apple Watch Accessories 50#(lf)#(lf)strap_mask = (df.desc.str.contains('strap | armband', case=False, na=False)|#(lf)                df.name.str.contains('strap | armband', case=False, na=False)|#(lf)                df.desc.str.contains('bands', case=False, na=False)|#(lf)                df.name.str.contains('bands', case=False, na=False)|#(lf)                df.desc.str.contains('bracelet', case=False, na=False)|#(lf)                df.name.str.contains('bracelet', case=False, na=False))#(lf)#(lf)df.loc[category & (type_5405_mask | strap_mask) & appl_watch_mask, 'category'] = ""Apple Watch Accessories""#(lf)#(lf)# Sound, Headphones, Players 34#(lf)#(lf)headphoenes_mask = (df.desc.str.contains('headphones | microphone | speaker | handsfree | player', case=False, na=False) |#(lf)                df.name.str.contains('headphones | microphone | speaker | handsfree | player', case=False, na=False))#(lf)#(lf)df.loc[category & (headphoenes_mask), 'category'] = ""Sound, Headphones, Players""#(lf)#(lf)# Software, Licenses 20#(lf)#(lf)software_mask = (df.desc.str.contains('Software license | software | microsoft | licenses | window', case=False, na=False) |#(lf)                  df.name.str.contains('Software license | software | microsoft | licenses | window', case=False, na=False))#(lf)#(lf)ado_mask = (df.sku.str.contains('ADO', case=False, na=False))#(lf)SOF_mask = (df.sku.str.contains('SOF', case=False, na=False))#(lf)#(lf)type_1416_mask = df.type.str.contains('1416', case=False, na=False)#(lf)#(lf)df.loc[category & (type_1416_mask | software_mask), 'category'] = ""Software, Licenses""#(lf)#(lf)# ""Cables"" 26#(lf)#(lf)cable_mask = (df.desc.str.contains('cable', case=False, na=False)|#(lf)                df.name.str.contains('cable', case=False, na=False)#(lf)                )#(lf)#(lf)df.loc[category & cable_mask, 'category'] = ""Cables""#(lf)#(lf)# Armbands, Bracelets, Belts 31#(lf)#(lf)df.loc[category & type_5405_mask, 'category'] = ""Armbands, Bracelets, Belts ""#(lf)#(lf)# ""Repair service, Install kit, Extended warranty""11#(lf)#(lf)warranty_mask = (df.desc.str.contains('warranty | plan | care | extended warranty', case=False, na=False) |  # Did not use 15 rows  with 1231_mask!!#(lf)                 df.name.str.contains('warranty | plan | care | extended warranty', case=False, na=False) #(lf)                 )#(lf)#(lf)df.loc[category & APP_mask & warranty_mask, 'category'] =""Repair service, Install kit, Extended warranty""#(lf)#(lf)# Network routers, Network equipment 21#(lf)#(lf)# core_mask = products_qu.category.str.contains("" core "", case=False, na=False)#(lf)dlk_mask = df.sku.str.contains(""dlk"", case=False, na=False)#(lf)#(lf)router_mask = (df.name.str.contains(""Ethernet | Wireless | network | internet | WiFi | Access Point"", case=False, na=False) |#(lf)                df.desc.str.contains(""Ethernet | Wireless | network | internet | WiFi | Access Point"", case=False, na=False))#(lf)#(lf)#(lf)df.loc[category & router_mask & ~(camera_mask & memo_mask & memo_mask_ & dockst_mask) , 'category'] =""Network routers, Network equipment""#(lf)#(lf)# additional NAS, HDD, SSD, Memory stick and cards 4#(lf)hard_dr_mask = (df.name.str.contains(""Hard Disk | hard drive | eSata card 6Gb"")|#(lf)                df.desc.str.contains(""Hard Disk | hard drive | eSata card 6Gb""))#(lf)#(lf)type_1276_mask = df.type.str.contains(""1276"")#(lf)#(lf)df.loc[category & type_1276_mask, 'category'] =""NAS, HDD, SSD, Memory stick and cards""#(lf)#(lf)# additional iMac 15#(lf)APP1213_mask = df.sku.str.contains(""APP1213"")#(lf)#(lf)df.loc[category & APP_mask & ~APP1213_mask, 'category'] = ""Apple iMac""#(lf)#(lf)# additional iMac 15#(lf)APP1213_mask = df.sku.str.contains(""APP1213"")#(lf)#(lf)df.loc[category & APP_mask & ~APP1213_mask, 'category'] = ""Apple iMac""#(lf)#(lf)# drop other into ""Electronic dev."" 133#(lf)# eldev_mask = df.type == (""Electronic Devises"")#(lf)#(lf)# df.loc[category, 'category'] =""Electronic Devises""#(lf)#(lf)# Drones#(lf)#(lf)# eldev_mask = df.category == (""Electronic Devises"")#(lf)#(lf)# drone_mask = (df.name.str.contains(""drone"", case=False, na=False)|#(lf)#                df.desc.str.contains(""drone"", case=False, na=False))#(lf)#(lf)# df.loc[drone_mask, 'category'] =""Drones""#(lf)",[df=Source]),
		    df = #"Run Python script"{[Name="df"]}[Value],
		    #"Changed Type" = Table.TransformColumnTypes(df,{{"sku", type text}, {"name", type text}, {"desc", type text}, {"price", type number}, {"in_stock", Int64.Type}, {"type", Int64.Type}, {"category", type text}}),
		    #"Duplicated Column" = Table.DuplicateColumn(#"Changed Type", "sku", "sku - Copy"),
		    #"Extracted First Characters" = Table.TransformColumns(#"Duplicated Column", {{"sku - Copy", each Text.Start(_, 3), type text}}),
		    #"Renamed Columns" = Table.RenameColumns(#"Extracted First Characters",{{"sku - Copy", "brand_code"}}),
		    #"Replaced Value" = Table.ReplaceValue(#"Renamed Columns","","Other Electronic Devices",Replacer.ReplaceValue,{"category"})
		in
		    #"Replaced Value"
	lineageTag: 50ab5e08-aae3-4fcf-a152-b0bcee5c92b0
	queryGroup: Cleaning

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

expression orders_CLEAN =
		let
		    Source = orders_RAW,
		    #"Removed Duplicates" = Table.Distinct(Source, {"order_id"}),
		    #"Filtered Rows" = Table.SelectRows(#"Removed Duplicates", each ([state] = "Completed")),
		    #"Changed Type" = Table.TransformColumnTypes(#"Filtered Rows",{{"created_date", type datetime}, {"total_paid", type number}})
		in
		    #"Changed Type"
	lineageTag: d8c6ce79-6a97-4db9-8fbf-5ced757e03fc
	queryGroup: Cleaning

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

expression orderlines_with_orders =
		let
		    Source = orderlines_CLEAN,
		    #"Merged Queries" = Table.NestedJoin(Source, {"id_order"}, orders_CLEAN, {"order_id"}, "orders_CLEAN", JoinKind.Inner),
		    #"Removed Columns" = Table.RemoveColumns(#"Merged Queries",{"orders_CLEAN"}),
		    #"Merged Queries1" = Table.NestedJoin(#"Removed Columns", {"sku"}, products_CLEAN, {"sku"}, "products_CLEAN", JoinKind.Inner),
		    #"Added Custom" = Table.AddColumn(#"Merged Queries1", "revenue", each [product_quantity]*[unit_price]),
		    #"Removed Columns1" = Table.RemoveColumns(#"Added Custom",{"products_CLEAN"}),
		    #"Run Python script" = Python.Execute("# add discount, total_discount and % discount#(lf)#(lf)df = df.merge(#(lf)    df.groupby('sku').agg(max_price=('unit_price', 'max')),#(lf)    on=""sku""#(lf))#(lf)#(lf)df['discount'] = (#(lf)    df['max_price'] - df['unit_price']#(lf))#(lf)#(lf)df['total_discount'] = (#(lf)    df['discount'] * df['product_quantity']#(lf))#(lf)df['percentage_discount'] = (#(lf)    100 * df['discount'] / df['max_price']#(lf))",[df=#"Removed Columns1"]),
		    df = #"Run Python script"{[Name="df"]}[Value],
		    #"Changed Type" = Table.TransformColumnTypes(df,{{"id", Int64.Type}, {"id_order", Int64.Type}, {"product_quantity", Int64.Type}, {"sku", type text}, {"unit_price", type number}, {"date", type datetime}, {"revenue", type number}, {"max_price", type number}, {"discount", type number}, {"total_discount", type number}, {"percentage_discount", type number}})
		in
		    #"Changed Type"
	lineageTag: cc8d13b2-6b8f-480b-995a-fc9b4dccb3a8
	queryGroup: Cleaning

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

